module.exports=function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=23)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.Model},function(t,e,i){"use strict";function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}i.d(e,"a",(function(){return o}))},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["utils/extractText"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["helpers/username"]},function(t,e){t.exports=flarum.core.compat["helpers/humanTime"]},,function(t,e){t.exports=flarum.core.compat["models/Post"]},function(t,e){t.exports=flarum.core.compat["components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},,function(t,e){t.exports=flarum.core.compat["components/CommentPost"]},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat["components/Alert"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionPage"]},,,function(t,e,i){"use strict";i.r(e);var o=i(0),n=i.n(o),r=i(5),s=i(15),a=i.n(s),f=i(2),l=i(1),d=i.n(l),c=i(16),u=function(t){function e(){return t.apply(this,arguments)||this}return Object(f.a)(e,t),e}(i.n(c)()(d.a,{revision:d.a.attribute("revision"),createdAt:d.a.attribute("createdAt",d.a.transformDate),deletedAt:d.a.attribute("deletedAt",d.a.transformDate),rollbackedAt:d.a.attribute("rollbackedAt",d.a.transformDate),actor:d.a.hasOne("actor"),deletedUser:d.a.hasOne("deletedUser"),rollbackedUser:d.a.hasOne("rollbackedUser"),inlineHtml:d.a.attribute("inlineHtml"),sideBySideHtml:d.a.attribute("sideBySideHtml"),combinedHtml:d.a.attribute("combinedHtml"),previewHtml:d.a.attribute("previewHtml"),comparisonBetween:d.a.attribute("comparisonBetween")})),p=i(9),h=i.n(p),v=i(10),b=i.n(v),g=i(17),w=i.n(g);function k(){return(k=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t}).apply(this,arguments)}var C=i(3),B=i.n(C),y=i(11),D=i.n(y),N=i(12),x=i.n(N),M=i(6),H=i.n(M),A=i(7),T=i.n(A),I=i(4),O=i.n(I),R=function(t){function e(){return t.apply(this,arguments)||this}Object(f.a)(e,t);var i=e.prototype;return i.view=function(){var t=k({},this.props);return delete t.item,delete t.subButton,delete t.postDate,t.type="button",m("button",t,this.getButtonContent())},i.getButtonContent=function(){var t=this.props.item,e=t.actor(),i=0==t.revision()?O()(app.translator.trans("the-turk-diff.forum.createdInfo",{username:H()(t.actor()),ago:T()(this.props.postDate)})):O()(app.translator.trans("the-turk-diff.forum.editedInfo",{username:H()(t.actor()),ago:T()(t.createdAt())}));return t.deletedAt()&&(!1===this.props.subButton?i=i+" "+app.translator.trans("the-turk-diff.forum.deletedText"):(e=t.deletedUser(),i=O()(app.translator.trans("the-turk-diff.forum.deletedInfo",{username:H()(t.deletedUser()),ago:T()(t.deletedAt())})))),[e.username()?D()(e):"",t.deletedAt()&&!1===this.props.subButton?x()("fas fa-caret-down",{className:"Button-caret"}):"",m("span",{className:"Button-label",title:i},t.deletedAt()&&!0===this.props.subButton?m("em",null,i):i)]},e}(B.a),S=i(18),P=i.n(S);function j(){return 1==("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}function E(t){return t.save({}).then((function(){return m.redraw()}))}var L=i(19),_=i.n(L),V=i(13),U=i.n(V),W=function(t){function e(){return t.apply(this,arguments)||this}Object(f.a)(e,t);var i=e.prototype;return i.init=function(){t.prototype.init.call(this),this.loading=!1,this.showing=!1,this.diffId=null,this.post=this.props.post,this.revision=this.props.item,this.list=new q({post:this.post,forModal:!0,selectedItem:this.revision.id(),moreResults:this.props.moreResults}),this.comparisonBetween=JSON.parse(this.revision.comparisonBetween())},i.className=function(){return"DiffModal"},i.title=function(){return[this.revision.actor().username()?D()(this.revision.actor()):"",0!=this.revision.revision()?n.a.translator.trans("the-turk-diff.forum.editedInfo",{username:m("a",{href:n.a.route.user(this.revision.actor()),config:m.route},H()(this.revision.actor())),ago:T()(this.revision.createdAt())}):n.a.translator.trans("the-turk-diff.forum.createdInfo",{username:m("a",{href:n.a.route.user(this.revision.actor()),config:m.route},H()(this.revision.actor())),ago:T()(this.post.createdAt())})]},i.config=function(t){if(this.showing&&!$(".ModalManager").hasClass("in")&&$(".ModalManager").addClass("in"),!t||this.diffId!=this.revision.id())return this.showing=!0,this.diffId=this.revision.id(),0!=this.revision.revision()&&this.comparisonBetween.new.revision!=this.comparisonBetween.old.revision?this.setDiffContent(n.a.session.user.preferences().diffRenderer?n.a.session.user.preferences().diffRenderer:"sideBySide"):this.setDiffContent("preview")},i.view=function(){var t=this;return m("div",{className:"Modal modal-dialog "+this.className()},m("div",{className:"Modal-content"},m("div",{className:"Modal-close App-backControl"},B.a.component({icon:"fas fa-times",onclick:this.hide.bind(this),className:"Button Button--icon Button--link"})),this.post.canDeleteEditHistory()&&this.revision.revision()!=this.post.revisionCount()||this.post.canRollbackEditHistory()&&this.$(".DeletedDiff").length!=this.post.revisionCount()?m(b.a,{className:"diffCotrollerDropdown App-primaryControl",icon:"fas fa-ellipsis-v",buttonClassName:"Button",menuClassName:"Dropdown-menu--right",label:n.a.translator.trans("the-turk-diff.forum.optionsButton")},this.post.canRollbackEditHistory()&&this.comparisonBetween.old.diffId?B.a.component({children:0==this.revision.revision()?n.a.translator.trans("the-turk-diff.forum.rollbackToOriginalButton"):this.revision.revision()==this.post.revisionCount()?0!=this.comparisonBetween.old.revision?n.a.translator.trans("the-turk-diff.forum.revertChangesButton"):n.a.translator.trans("the-turk-diff.forum.rollbackToOriginalButton"):n.a.translator.trans("the-turk-diff.forum.rollbackButton",{number:this.revision.revision()}),icon:"fas fa-reply",onclick:function(){if(confirm(n.a.translator.trans("the-turk-diff.forum.confirmRollback",{number:t.revision.revision()}))){t.loading=!0,m.redraw();var e=t.revision.revision()==t.post.revisionCount()?t.comparisonBetween.old.diffId:t.revision.id();n.a.request({url:n.a.forum.attribute("apiUrl")+"/diff/"+e,method:"POST"}).then((function(){E(t.post),n.a.modal.close(),n.a.cache.diffs&&n.a.cache.diffs[t.post.id()]&&delete n.a.cache.diffs[t.post.id()],t.showAlert("success","rollback")})).catch((function(){t.loading=!1,m.redraw(),E(t.post),t.showAlert("error","rollback")}))}}}):"",this.post.canDeleteEditHistory()&&this.revision.revision()!=this.post.revisionCount()?B.a.component({children:n.a.translator.trans("the-turk-diff.forum.deleteButton"),icon:"far fa-trash-alt",onclick:function(){confirm(n.a.translator.trans("the-turk-diff.forum.confirmDelete"))&&(t.loading=!0,m.redraw(),t.revision.delete().then((function(){n.a.modal.close(),n.a.cache.diffs&&n.a.cache.diffs[t.post.id()]&&delete n.a.cache.diffs[t.post.id()],t.showAlert("success","delete")})).catch((function(){t.loading=!1,m.redraw(),t.showAlert("error","delete")})))}}):""):"",m("div",{className:"Modal-header"},m("h3",{className:"App-titleControl App-titleControl--text"},this.title())),this.content()))},i.content=function(){var t=this;return[m("div",{className:"diff-grid"},m("div",{className:"diff-grid-item diff-grid-controls"},m("div",{className:"diffSwitcher"},0!=this.revision.revision()&&this.comparisonBetween.new.revision!=this.comparisonBetween.old.revision?[m("div",{className:"tooltip-wrapper","data-original-title":n.a.translator.trans("the-turk-diff.forum.tooltips.inline")},B.a.component({icon:"fas fa-grip-lines",onclick:function(){t.$(".diffTooltip").tooltip("hide"),t.setDiffContent("inline")},className:"Button Button--icon Button--link inlineView",config:function(t,e){return!1!==j()||e?"":$(t).parent().tooltip({trigger:"hover"}).data("bs.tooltip").tip().addClass("diffTooltip")}})),m("div",{className:"tooltip-wrapper","data-original-title":n.a.translator.trans("the-turk-diff.forum.tooltips.sideBySide")},B.a.component({icon:"fas fa-columns",onclick:function(){t.$(".diffTooltip").tooltip("hide"),t.setDiffContent("sideBySide")},className:"Button Button--icon Button--link sideBySideView",config:function(t,e){return!1!==j()||e?"":$(t).parent().tooltip({trigger:"hover"}).data("bs.tooltip").tip().addClass("diffTooltip")}})),m("div",{className:"tooltip-wrapper","data-original-title":n.a.translator.trans("the-turk-diff.forum.tooltips.combined")},B.a.component({icon:"far fa-square",onclick:function(){t.$(".diffTooltip").tooltip("hide"),t.setDiffContent("combined")},className:"Button Button--icon Button--link combinedView",config:function(t,e){return!1!==j()||e?"":$(t).parent().tooltip({trigger:"hover"}).data("bs.tooltip").tip().addClass("diffTooltip")}}))]:"",m("div",{className:"tooltip-wrapper","data-original-title":n.a.translator.trans("the-turk-diff.forum.tooltips.preview")},B.a.component({icon:"far fa-eye",onclick:function(){t.$(".diffTooltip").tooltip("hide"),t.setDiffContent("preview")},className:"Button Button--icon Button--link diffPreview",config:function(t,e){return!1!==j()||e?"":$(t).parent().tooltip({trigger:"hover"}).attr("data-original-title",n.a.translator.trans("the-turk-diff.forum.tooltips.preview")).data("bs.tooltip").tip().addClass("diffTooltip")}})))),m("div",{className:"diff-grid-item diff-grid-info"},m("div",{className:"revisionInfo"},m("h4",null,n.a.translator.transChoice("the-turk-diff.forum.revisions",this.post.revisionCount(),{revisionCount:this.post.revisionCount()})),m("p",{class:"diffInfoContainer"}))),m("div",{className:"diff-grid-item diff-grid-revisions"},this.list.render()),m("div",{className:"diff-grid-item diff-grid-diff"},m("div",{className:"diffContents"},m("div",{className:"previewContainer Post-body"+(!1===n.a.forum.attribute("textFormattingForDiffPreviews")?" diff-skip-formatting":"")},this.renderHtml(this.revision.data.attributes.previewHtml)),m("div",{className:"diffContainer"}))),U.a.component({className:"DiffModal-loading"+(this.loading?" active":"")}))]},i.onready=function(){var t=this.$(".DiffList-content"),e=this.$("li#parentDiff"+this.revision.id());t.animate({scrollTop:e.offset().top-t.offset().top+t.scrollTop()})},i.showAlert=function(t,e){var i={success:"the-turk-diff.forum."+e+"SuccessMessage",error:"the-turk-diff.forum."+e+"ErrorMessage"}[t];n.a.alerts.show(new _.a({type:t,children:n.a.translator.trans(i)}))},i.renderHtml=function(t){return m.trust(t)},i.setDiffContent=function(t){var e,i=this.$(".diffContainer"),o=this.$(".previewContainer"),r=(this.$(".diffTooltip"),this.$(".Button.sideBySideView")),s=this.$(".Button.inlineView"),a=this.$(".Button.combinedView"),f=this.$(".Button.diffPreview");return"preview"===t?(i.hide(),this.$(".previewContainer").show(),f.prop("disabled",!0),f.parent().siblings().children().prop("disabled",!1),this.setInfoContent(!0)):("sideBySide"===t?(e=this.renderHtml(this.revision.data.attributes.sideBySideHtml),r.prop("disabled",!0),r.parent().siblings().children().prop("disabled",!1)):"inline"===t?(e=this.renderHtml(this.revision.data.attributes.inlineHtml),s.prop("disabled",!0),s.parent().siblings().children().prop("disabled",!1)):"combined"===t&&(e=this.renderHtml(this.revision.data.attributes.combinedHtml),a.prop("disabled",!0),a.parent().siblings().children().prop("disabled",!1)),e?(i.html(e),o.is(":visible")&&(i.show(),o.hide()),n.a.session.user.savePreferences({diffRenderer:t}),this.setInfoContent()):void 0)},i.setInfoContent=function(t){void 0===t&&(t=!1);var e=this.$(".diffInfoContainer"),i=t||0==this.revision.revision()||this.comparisonBetween.new.revision==this.comparisonBetween.old.revision?O()(n.a.translator.trans("the-turk-diff.forum.previewMode.sentence",{content:0==this.comparisonBetween.new.revision?n.a.translator.trans("the-turk-diff.forum.previewMode.originalContent"):this.comparisonBetween.new.revision==this.post.revisionCount()?n.a.translator.trans("the-turk-diff.forum.previewMode.currentContent"):n.a.translator.trans("the-turk-diff.forum.previewMode.revisionWithNumber",{number:this.comparisonBetween.new.revision})})):O()(n.a.translator.trans("the-turk-diff.forum.differences.sentence",{old:-1==this.comparisonBetween.old.revision?n.a.translator.trans("the-turk-diff.forum.differences.currentContent"):0==this.comparisonBetween.old.revision?n.a.translator.trans("the-turk-diff.forum.differences.originalContent"):n.a.translator.trans("the-turk-diff.forum.differences.revisionWithNumber",{number:this.comparisonBetween.old.revision}),new:0==this.comparisonBetween.new.revision?n.a.translator.trans("the-turk-diff.forum.differences.originalContent"):this.comparisonBetween.new.revision==this.post.revisionCount()?n.a.translator.trans("the-turk-diff.forum.differences.currentContent"):n.a.translator.trans("the-turk-diff.forum.differences.revisionWithNumber",{number:this.comparisonBetween.new.revision})}));return e.html(i)},e}(P.a),q=function(t){function e(){return t.apply(this,arguments)||this}Object(f.a)(e,t);var i=e.prototype;return i.init=function(){this.loading=!1,this.post=this.props.post,null!==this.props.moreResults?this.moreResults=this.props.moreResults:this.moreResults=!1,this.forModal=this.props.forModal,this.selectedItem=this.props.selectedItem,n.a.cache.diffs||(n.a.cache.diffs=[])},i.view=function(){var t=this,e=n.a.cache.diffs[this.post.id()]||[];return m("div",{className:"DiffList-container"},m("div",{className:"DiffList-content"},m("ul",null,e.length?e.map((function(e){var i=[];return e.forEach((function(t){i.push(t)})),i.map((function(e){var i=R.component({postDate:t.post.createdAt(),subButton:!1,item:e,onclick:function(){if(e.deletedAt())t.toggleSubDiff(e.id());else if(n.a.modal.show(new W({item:e,post:t.post,moreResults:t.moreResults})),$(".diffTooltip").tooltip("hide"),t.forModal){var i=t.$("li#parentDiff"+e.id());i.find("button").prop("disabled",!0),i.siblings().find("button").prop("disabled",!1),i.siblings().removeClass("active"),i.addClass("active")}},config:function(i,o){return!1!==j()||o?"":$(i).tooltip({trigger:"hover",placement:"left",container:"body"}).attr("data-original-title",O()(e.revision()==t.post.revisionCount()?n.a.translator.trans("the-turk-diff.forum.tooltips.mostRecent"):0==e.revision()?n.a.translator.trans("the-turk-diff.forum.tooltips.originalContent"):n.a.translator.trans("the-turk-diff.forum.tooltips.revisionWithNumber",{number:e.revision()}))).data("bs.tooltip").tip().addClass(e.deletedAt()?"diffTooltip deletedDiffTooltip":"diffTooltip")}});return[m("li",{className:"Diff ParentDiff"+(e.deletedAt()?" DeletedDiff":""),id:"parentDiff"+e.id()},i),e.deletedAt()?m("li",{className:"Diff SubDiff",id:"subDiff"+e.id()},R.component({postDate:t.post.createdAt(),subButton:!0,item:e})):""]}))})):"",this.loading?U.a.component({className:"LoadingIndicator--block"}):e.length?"":m("div",{className:"DiffList-empty"},n.a.translator.trans("the-turk-diff.forum.emptyText")))))},i.config=function(t,e){var i=this;if(!t){if(this.forModal&&this.selectedItem){var o=this.$("li#parentDiff"+this.selectedItem);o.find("button").prop("disabled",!0),o.addClass("active")}var n=this.$(".DiffList-content"),r="auto"===n.css("overflow")?n:$(window),s=function(){var t=r.scrollTop(),e=r.height(),o=r===n?0:n.offset().top,s=n[0].scrollHeight;i.moreResults&&!i.loading&&t+e>=o+s&&i.loadMore()};r.on("scroll",s),e.onunload=function(){r.off("scroll",s)}}},i.load=function(){if(n.a.cache.diffs[this.post.id()])return this.redrawList();this.loadMore()},i.loadMore=function(){var t=this;if(this.loading=!0,this.redrawList(),!n.a.cache.diffs[this.post.id()]||n.a.cache.diffs[this.post.id()].length!=this.post.revisionCount()){var e=n.a.cache.diffs[this.post.id()]?{id:this.post.id(),page:{offset:10*n.a.cache.diffs[this.post.id()].length}}:{id:this.post.id()};return n.a.store.find("diff",e).then(this.parseResults.bind(this)).catch((function(){})).then((function(){t.loading=!1,t.redrawList()}))}},i.parseResults=function(t){return n.a.cache.diffs[this.post.id()]=n.a.cache.diffs[this.post.id()]||[],t.length&&n.a.cache.diffs[this.post.id()].push(t),this.moreResults=!!t.payload.links.next,t},i.toggleSubDiff=function(t){var e=this.$("li.Diff#subDiff"+t),i=this.$("li.Diff#parentDiff"+t).find(".icon");e.toggle(),i.hasClass("fa-caret-down")?i.removeClass("fa-caret-down").addClass("fa-caret-up"):i.removeClass("fa-caret-up").addClass("fa-caret-down")},i.redrawList=function(){if(m.redraw(),!this.forModal)return E(this.post)},e}(w.a),F=function(t){function e(){return t.apply(this,arguments)||this}Object(f.a)(e,t),e.initProps=function(e){e.className="DiffDropdown",e.buttonClassName="Button Button--link",e.menuClassName=e.menuClassName,e.label=app.translator.trans("the-turk-diff.forum.editedText"),e.icon="fas fa-history",t.initProps.call(this,e)};var i=e.prototype;return i.init=function(){t.prototype.init.call(this),this.post=this.props.post,this.list=new q({post:this.post,forModal:!1,selectedItem:null,moreResults:null})},i.getButton=function(){var e=t.prototype.getButton.call(this);return e.attrs.title=this.props.label,e.attrs.onclick=this.onclick.bind(this),e},i.getButtonContent=function(){return[x()(this.props.icon,{className:"Button-icon"}),m("span",{className:"Button-label"},this.props.label)]},i.getMenu=function(){return m("div",{className:"Dropdown-menu "+this.props.menuClassName},m("div",{className:"DiffList-header"},m("h4",null,app.translator.transChoice("the-turk-diff.forum.revisionInfo",this.props.post.revisionCount(),{revisionCount:this.props.post.revisionCount()}))),this.showing?this.list.render():"")},i.onclick=function(){this.list.load()},e}(b.a),z=i(20),J=i.n(z);n.a.initializers.add("the-turk/diff",(function(){n.a.store.models.diff=u,h.a.prototype.revisionCount=d.a.attribute("revisionCount"),h.a.prototype.canViewEditHistory=d.a.attribute("canViewEditHistory"),h.a.prototype.canRollbackEditHistory=d.a.attribute("canRollbackEditHistory"),h.a.prototype.canDeleteEditHistory=d.a.attribute("canDeleteEditHistory"),Object(r.extend)(a.a.prototype,"headerItems",(function(t){var e=this.props.post;e.isEdited()&&!e.isHidden()&&e.canViewEditHistory()&&e.revisionCount()>0&&t.replace("edited",F.component({post:e})),this.isEditing()&&n.a.cache.diffs&&n.a.cache.diffs[this.props.post.id()]&&delete n.a.cache.diffs[this.props.post.id()]})),Object(r.extend)(J.a.prototype,"init",(function(){var t=$("body");t.on("click","li.ParentDiff.DeletedDiff",(function(t){t.stopPropagation()})),t.on("click","li.SubDiff",(function(t){t.stopPropagation()}))}))}))}]);
//# sourceMappingURL=forum.js.map